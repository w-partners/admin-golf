<!DOCTYPE html>
<html lang="ko">
<!-- ================================================================ -->
<!-- 파일: index.html (메인 페이지) -->
<!-- 설명: 골프장 예약 관리 시스템의 메인 화면 -->
<!-- 기능: 4개 탭 매트릭스 뷰 (데일리부킹/조인, 패키지부킹/조인) -->
<!-- ================================================================ -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>골프장 예약 관리 시스템</title>
    <!-- ============ CSS 스타일 섹션 시작 ============ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            line-height: 1.4;
        }

        /* 공통 헤더와 퀵메뉴 스타일은 components/quick-menu.js에서 자동 로드됩니다 */

        /* Container */
        .container {
            padding: 20px 24px;
            max-width: 100%;
            overflow-x: hidden;
        }

        /* ============ 매트릭스 뷰 탭 스타일 ============ */
        /* Matrix View Tabs */
        .matrix-tabs {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #495057;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #e9ecef;
        }

        .tab-button.active {
            color: #007bff;
            background: white;
            border-bottom-color: #007bff;
        }

        /* ============ 매트릭스 테이블 컨테이너 스타일 ============ */
        /* Matrix Table Container */
        .matrix-container {
            background: white;
            min-height: 400px;
            overflow-x: auto;
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            table-layout: fixed;
        }

        /* Fixed Headers */
        .matrix-table th {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Header specific widths */
        .matrix-table th.region-col {
            position: sticky;
            left: 0;
            width: 80px;
            min-width: 80px;
            z-index: 15;
            background: #f8f9fa;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table th.golf-course-col {
            position: sticky;
            left: 80px;
            width: 150px;
            min-width: 150px;
            z-index: 14;
            background: #f8f9fa;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        /* Fixed Left Columns */
        .matrix-table .region-col {
            position: sticky;
            left: 0;
            width: 80px;
            min-width: 80px;
            z-index: 6;
            background: #fff;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table .golf-course-col {
            position: sticky;
            left: 80px;
            width: 150px;
            min-width: 150px;
            z-index: 5;
            background: #fff;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table td {
            border: 1px solid #dee2e6;
            padding: 4px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        /* Date Columns */
        .date-col {
            width: 120px;
            min-width: 120px;
        }

        /* Time Slot Badges */
        .time-slots {
            display: flex;
            justify-content: space-between;
            gap: 2px;
            width: 100%;
        }

        .time-slot {
            flex: 1;
            background: #e9ecef;
            color: #495057;
            padding: 8px 4px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 32px;
            text-align: center;
            border: 1px solid transparent;
        }

        .time-slot:hover {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        .time-slot.has-data {
            background: #28a745;
            color: white;
            border-color: #1e7e34;
            font-weight: 600;
        }

        .time-slot.has-data:hover {
            background: #1e7e34;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(40,167,69,0.4);
        }

        /* Row styling */
        .matrix-table tr:hover td:not(.region-col):not(.golf-course-col) {
            background-color: #f8f9fa;
        }

        /* Region grouping */
        .region-group {
            border-top: 2px solid #007bff;
        }

        .region-group:first-child {
            border-top: none;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Status indicators */
        .status-info {
            padding: 12px 24px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .global-header {
                padding: 8px 12px;
                flex-direction: column;
                gap: 8px;
            }

            .quick-menu {
                padding: 8px 12px;
            }

            .container {
                padding: 12px;
            }

            .tab-button {
                padding: 12px 8px;
                font-size: 13px;
            }

            .matrix-container {
                min-height: 300px;
            }
        }
    </style>
    <!-- ============ CSS 스타일 섹션 끝 ============ -->
</head>
<body>
    <!-- ============ HTML BODY 섹션 시작 ============ -->
    <!-- 공통 헤더와 퀵메뉴는 JavaScript로 자동 생성됩니다 -->

    <!-- ============ 메인 컨테이너 섹션 ============ -->
    <!-- Main Container -->
    <div class="container">
        <!-- ============ 매트릭스 뷰 탭 섹션 ============ -->
        <!-- Matrix View Tabs -->
        <div class="matrix-tabs">
            <!-- ============ 탭 버튼 영역 ============ -->
            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchMatrixTab('daily-booking')">데일리부킹</button>
                <button class="tab-button" onclick="switchMatrixTab('daily-join')">데일리조인</button>
                <button class="tab-button" onclick="switchMatrixTab('package-booking')">패키지부킹</button>
                <button class="tab-button" onclick="switchMatrixTab('package-join')">패키지조인</button>
            </div>

            <!-- ============ 탭 컨텐츠 영역 ============ -->
            <!-- Tab Contents -->
            <div id="daily-booking" class="tab-content active">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">지역</th>
                                <th class="golf-course-col">골프장</th>
                                <th class="date-col">오늘<br>01/09</th>
                                <th class="date-col">내일<br>01/10</th>
                                <th class="date-col">모레<br>01/11</th>
                                <th class="date-col">01/12<br>토</th>
                                <th class="date-col">01/13<br>일</th>
                                <th class="date-col">01/14<br>월</th>
                                <th class="date-col">01/15<br>화</th>
                                <!-- 90일까지 동적 생성 -->
                            </tr>
                        </thead>
                        <tbody id="matrix-body-daily-booking">
                            <!-- 동적으로 생성될 매트릭스 데이터 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="daily-join" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">지역</th>
                                <th class="golf-course-col">골프장</th>
                                <th class="date-col">오늘<br>01/09</th>
                                <th class="date-col">내일<br>01/10</th>
                                <th class="date-col">모레<br>01/11</th>
                                <th class="date-col">01/12<br>토</th>
                                <th class="date-col">01/13<br>일</th>
                                <th class="date-col">01/14<br>월</th>
                                <th class="date-col">01/15<br>화</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-daily-join">
                            <!-- 동적으로 생성될 매트릭스 데이터 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="package-booking" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">지역</th>
                                <th class="golf-course-col">골프장</th>
                                <th class="date-col">오늘<br>01/09</th>
                                <th class="date-col">내일<br>01/10</th>
                                <th class="date-col">모레<br>01/11</th>
                                <th class="date-col">01/12<br>토</th>
                                <th class="date-col">01/13<br>일</th>
                                <th class="date-col">01/14<br>월</th>
                                <th class="date-col">01/15<br>화</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-package-booking">
                            <!-- 동적으로 생성될 매트릭스 데이터 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="package-join" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">지역</th>
                                <th class="golf-course-col">골프장</th>
                                <th class="date-col">오늘<br>01/09</th>
                                <th class="date-col">내일<br>01/10</th>
                                <th class="date-col">모레<br>01/11</th>
                                <th class="date-col">01/12<br>토</th>
                                <th class="date-col">01/13<br>일</th>
                                <th class="date-col">01/14<br>월</th>
                                <th class="date-col">01/15<br>화</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-package-join">
                            <!-- 동적으로 생성될 매트릭스 데이터 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Status Info -->
            <div class="status-info">
                <span id="matrix-stats">총 0개 골프장 • 0개 티타임</span>
                <span>포트 5555 PostgreSQL • 실시간 업데이트</span>
            </div>
        </div>
    </div>

    <!-- ============ JavaScript 섹션 시작 ============ -->
    <!-- 공통 퀵메뉴 컴포넌트 -->
    <script src="components/quick-menu.js"></script>
    <script>
        // 현재 활성 탭
        let currentMatrixTab = 'daily-booking';
        
        // 동적 데이터 저장소
        let 골프장데이터 = {};
        let 매트릭스데이터 = {};
        let 현재매트릭스데이터 = null;  // 클릭 이벤트용 현재 활성 매트릭스 데이터
        let 날짜배열 = [];

        // 날짜 생성 (90일)
        function 날짜생성() {
            const dates = [];
            const today = new Date();
            
            for (let i = 0; i < 90; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const weekDay = ['일', '월', '화', '수', '목', '금', '토'][date.getDay()];
                
                dates.push({
                    display: i === 0 ? '오늘' : i === 1 ? '내일' : i === 2 ? '모레' : `${month}/${day}`,
                    subDisplay: i < 3 ? `${month}/${day}` : weekDay,
                    fullDate: date.toISOString().split('T')[0]
                });
            }
            
            return dates;
        }

        // API에서 골프장 데이터 로드
        async function 골프장데이터로드() {
            try {
                const response = await fetch('http://localhost:3001/api/golf-courses');
                if (response.ok) {
                    골프장데이터 = await response.json();
                    console.log('골프장 데이터 로드 완료:', 골프장데이터);
                } else {
                    console.error('골프장 데이터 로드 실패');
                    골프장데이터 = {};
                }
            } catch (error) {
                console.error('골프장 데이터 로드 오류:', error);
                골프장데이터 = {};
            }
        }

        // localStorage에서 티타임 데이터 로드
        function localStorage에서티타임데이터로드() {
            try {
                const savedTeeTimes = localStorage.getItem('savedTeeTimes');
                if (!savedTeeTimes) {
                    console.log('📂 localStorage에 저장된 티타임이 없습니다.');
                    return [];
                }
                
                const parsedData = JSON.parse(savedTeeTimes);
                console.log(`📂 localStorage에서 ${parsedData.length}개 티타임 로드됨:`, parsedData);
                return parsedData;
            } catch (error) {
                console.error('❌ localStorage 티타임 데이터 파싱 오류:', error);
                return [];
            }
        }

        // 티타임 데이터를 부킹 유형별로 분류
        function 티타임데이터분류(teeTimeData) {
            const classified = {
                'daily-booking': [],
                'daily-join': [],
                'package-booking': [],
                'package-join': []
            };
            
            teeTimeData.forEach(teeTime => {
                // 인원 수에 따른 부킹/조인 분류
                const players = parseInt(teeTime.players) || 0;
                const isBooking = players >= 4;
                const isJoin = players < 4 && players > 0;
                
                // 패키지 여부 확인 (기타 필드에 '패키지' 포함 여부로 임시 구분)
                const isPackage = teeTime.other && teeTime.other.includes('패키지');
                
                if (isPackage) {
                    if (isBooking) classified['package-booking'].push(teeTime);
                    else if (isJoin) classified['package-join'].push(teeTime);
                } else {
                    if (isBooking) classified['daily-booking'].push(teeTime);
                    else if (isJoin) classified['daily-join'].push(teeTime);
                }
            });
            
            console.log('📊 티타임 분류 결과:', {
                'daily-booking': classified['daily-booking'].length,
                'daily-join': classified['daily-join'].length,
                'package-booking': classified['package-booking'].length,
                'package-join': classified['package-join'].length
            });
            
            return classified;
        }

        // localStorage 데이터를 매트릭스 형식으로 변환
        function localStorage데이터를매트릭스로변환(classifiedData, tabName) {
            const teeTimesForTab = classifiedData[tabName] || [];
            
            // 골프장별 그룹화
            const golfCourseGroups = {};
            teeTimesForTab.forEach(teeTime => {
                const golfCourse = teeTime.golfCourse || '미지정';
                if (!golfCourseGroups[golfCourse]) {
                    golfCourseGroups[golfCourse] = [];
                }
                golfCourseGroups[golfCourse].push(teeTime);
            });
            
            // 매트릭스 형식으로 변환
            const matrix = [];
            Object.entries(golfCourseGroups).forEach(([golfCourse, teeTimes]) => {
                // 지역 정보 추출 (첫 번째 티타임에서)
                const region = teeTimes[0]?.region || '미지정';
                
                // 날짜별 시간대별 집계
                const dates = {};
                teeTimes.forEach(teeTime => {
                    const date = teeTime.date;
                    const time = teeTime.time || '0000';
                    const hour = parseInt(time.substring(0, 2)) || 0;
                    
                    // 시간대 분류
                    let timePart = '2부'; // 기본값
                    if (hour < 10) timePart = '1부';
                    else if (hour >= 15) timePart = '3부';
                    
                    if (!dates[date]) {
                        dates[date] = { '1부': 0, '2부': 0, '3부': 0 };
                    }
                    dates[date][timePart]++;
                });
                
                matrix.push({
                    golfCourse,
                    region,
                    dates
                });
            });
            
            return matrix;
        }

        // API에서 매트릭스 데이터 로드 (탭별 필터링)
        async function 매트릭스데이터로드(tabName) {
            // 1. API에서 티타임 매트릭스 데이터 로드
            let apiMatrixData = {};
            try {
                const response = await fetch('http://localhost:3001/api/tee-time-matrix');
                if (response.ok) {
                    apiMatrixData = await response.json();
                    console.log(`✅ API 매트릭스 데이터 로드 완료 (${tabName}):`, Object.keys(apiMatrixData).length, '개 골프장');
                } else {
                    console.log('⚠️ API 매트릭스 데이터 로드 실패');
                    apiMatrixData = {};
                }
            } catch (error) {
                console.log('⚠️ API 매트릭스 데이터 로드 오류:', error.message);
                apiMatrixData = {};
            }
            
            // 2. 탭별 필터링된 데이터 생성
            const filteredMatrix = [];
            Object.entries(apiMatrixData).forEach(([courseKey, courseData]) => {
                const filteredDates = {};
                
                // 각 날짜별로 해당 탭에 맞는 데이터만 추출
                Object.entries(courseData.dates).forEach(([date, dateData]) => {
                    filteredDates[date] = { part1: 0, part2: 0, part3: 0 };
                    
                    // 탭별로 해당하는 데이터만 집계
                    if (tabName === 'daily-booking') {
                        filteredDates[date].part1 = dateData.부킹_part1 || 0;
                        filteredDates[date].part2 = dateData.부킹_part2 || 0;
                        filteredDates[date].part3 = dateData.부킹_part3 || 0;
                    } else if (tabName === 'daily-join') {
                        filteredDates[date].part1 = dateData.조인_part1 || 0;
                        filteredDates[date].part2 = dateData.조인_part2 || 0;
                        filteredDates[date].part3 = dateData.조인_part3 || 0;
                    } else if (tabName === 'package-booking') {
                        filteredDates[date].part1 = dateData.패키지_part1 || 0;
                        filteredDates[date].part2 = dateData.패키지_part2 || 0;
                        filteredDates[date].part3 = dateData.패키지_part3 || 0;
                    } else if (tabName === 'package-join') {
                        // 패키지조인은 현재 별도 구분이 없어서 0으로 처리 (추후 확장 가능)
                        filteredDates[date].part1 = 0;
                        filteredDates[date].part2 = 0;
                        filteredDates[date].part3 = 0;
                    }
                });
                
                filteredMatrix.push({
                    golfCourse: courseData.courseName,
                    region: courseData.region,
                    dates: filteredDates
                });
            });
            
            // 3. 날짜 배열 생성 (90일)
            const dates = 날짜생성().map(d => d.fullDate);
            
            // 4. 최종 데이터 저장
            매트릭스데이터[tabName] = {
                dates: dates,
                matrix: filteredMatrix
            };
            현재매트릭스데이터 = 매트릭스데이터[tabName];
            날짜배열 = dates;
            
            console.log(`🔄 탭별 매트릭스 데이터 준비 완료 (${tabName}):`, {
                courses: filteredMatrix.length,
                dates: dates.length
            });
        }

        // 탭별 매트릭스 테이블 생성 함수
        function 매트릭스테이블생성(tabName) {
            const tbody = document.getElementById(`matrix-body-${tabName}`);
            if (!tbody) {
                console.error(`테이블 바디를 찾을 수 없습니다: matrix-body-${tabName}`);
                return;
            }

            const tabData = 매트릭스데이터[tabName];
            if (!tabData || !tabData.matrix || tabData.matrix.length === 0) {
                tbody.innerHTML = '<tr><td colspan="100%" style="text-align: center; padding: 40px; color: #666;">데이터를 로드 중입니다...</td></tr>';
                return;
            }

            let html = '';
            let regionCount = 0;
            let golfCourseCount = 0;
            let totalTeeTimeCount = 0;
            const processedRegions = new Set();

            // 지역별 그룹화
            const regionGroups = {};
            tabData.matrix.forEach(item => {
                if (!regionGroups[item.region]) {
                    regionGroups[item.region] = [];
                }
                regionGroups[item.region].push(item);
            });

            Object.entries(regionGroups).forEach(([region, courses]) => {
                if (!processedRegions.has(region)) {
                    regionCount++;
                    processedRegions.add(region);
                }

                courses.forEach((course, index) => {
                    golfCourseCount++;
                    html += `<tr class="${index === 0 ? 'region-group' : ''}">`;
                    
                    // 지역 칼럼 (첫 번째 골프장에서만 표시)
                    if (index === 0) {
                        html += `<td class="region-col" rowspan="${courses.length}">${region}</td>`;
                    }
                    
                    // 골프장 칼럼
                    html += `<td class="golf-course-col">${course.golfCourse}</td>`;
                    
                    // 날짜별 시간대 칼럼들
                    날짜배열.forEach(date => {
                        const dateSlots = course.dates[date] || { part1: 0, part2: 0, part3: 0 };
                        
                        const part1Count = dateSlots.part1 || 0;
                        const part2Count = dateSlots.part2 || 0;
                        const part3Count = dateSlots.part3 || 0;
                        
                        totalTeeTimeCount += part1Count + part2Count + part3Count;
                        
                        html += `<td class="date-col">
                            <div class="time-slots">
                                <div class="time-slot ${part1Count > 0 ? 'has-data' : ''}" 
                                     onclick="상세페이지이동('${course.golfCourse}', '${date}', '1부', '${tabName}')"
                                     title="1부: ${part1Count}개">
                                     ${part1Count}
                                </div>
                                <div class="time-slot ${part2Count > 0 ? 'has-data' : ''}" 
                                     onclick="상세페이지이동('${course.golfCourse}', '${date}', '2부', '${tabName}')"
                                     title="2부: ${part2Count}개">
                                     ${part2Count}
                                </div>
                                <div class="time-slot ${part3Count > 0 ? 'has-data' : ''}" 
                                     onclick="상세페이지이동('${course.golfCourse}', '${date}', '3부', '${tabName}')"
                                     title="3부: ${part3Count}개">
                                     ${part3Count}
                                </div>
                            </div>
                        </td>`;
                    });
                    
                    html += '</tr>';
                });
            });
            
            tbody.innerHTML = html;
            
            // 통계 업데이트 (현재 활성 탭에서만)
            if (tabName === currentMatrixTab) {
                document.getElementById('matrix-stats').textContent = 
                    `총 ${golfCourseCount}개 골프장 • ${totalTeeTimeCount}개 티타임`;
            }
        }


        // 탭 전환 함수
        function switchMatrixTab(tabName) {
            console.log(`🔄 탭 전환: ${tabName}`);
            
            // 탭 버튼 활성화 상태 변경
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 탭 컨텐츠 활성화 상태 변경
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            // 현재 활성 탭 업데이트
            currentMatrixTab = tabName;
            
            // 해당 탭의 매트릭스 데이터 로드 및 테이블 생성
            매트릭스데이터로드(tabName).then(() => {
                매트릭스테이블생성(tabName);
            });
        }

        // 상세 페이지 이동
        function 상세페이지이동(golfCourse, date, timePart, tabName) {
            // 탭별 type 매핑
            const typeMap = {
                'daily-booking': 'booking',
                'daily-join': 'join', 
                'package-booking': 'package',
                'package-join': 'package'  // 패키지조인은 패키지로 처리
            };
            
            const type = typeMap[tabName] || 'all';
            
            // 지역 정보를 매트릭스 데이터에서 찾기
            let region = '';
            const tabData = 매트릭스데이터[tabName];
            if (tabData && tabData.matrix) {
                const courseData = tabData.matrix.find(item => 
                    item.golfCourse === golfCourse
                );
                if (courseData) {
                    region = courseData.region;
                }
            }
            
            // URL 파라미터 구성
            const params = new URLSearchParams({
                golfCourse: golfCourse,
                region: region,
                date: date,
                timePart: timePart,
                type: type
            });
            
            // 티타임 목록 페이지로 이동
            window.location.href = `tee-time-list.html?${params.toString()}`;
        }

        // 로그인/로그아웃 관련 함수들은 공통 컴포넌트에서 처리됩니다

        // 페이지 로드시 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🏌️ 골프장 예약 관리 시스템 초기화 시작');
            
            // 공통 레이아웃이 먼저 로드되기를 잠깐 기다림
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // 1. 골프장 데이터 로드
            await 골프장데이터로드();
            
            // 2. 날짜 헤더 동적 생성
            const dates = 날짜생성();
            const tableHeaders = document.querySelectorAll('.matrix-table thead tr');
            
            tableHeaders.forEach(header => {
                // 기존 날짜 컬럼 제거 (처음 2개는 지역/골프장 컬럼)
                const existingDateCols = header.querySelectorAll('.date-col');
                existingDateCols.forEach(col => col.remove());
                
                // 새 날짜 컬럼 추가
                dates.forEach(dateInfo => {
                    const th = document.createElement('th');
                    th.className = 'date-col';
                    th.innerHTML = `${dateInfo.display}<br>${dateInfo.subDisplay}`;
                    header.appendChild(th);
                });
            });
            
            // 3. 초기 탭 데이터 로드 (데일리부킹부터 시작)
            console.log('초기 매트릭스 데이터 로드 중...');
            await 매트릭스데이터로드(currentMatrixTab);
            매트릭스테이블생성(currentMatrixTab);
            
            console.log('✅ 시스템 초기화 완료');
        });
    </script>
    <!-- ============ JavaScript 섹션 끝 ============ -->
</body>
<!-- ============ HTML 문서 끝 ============ -->
</html>