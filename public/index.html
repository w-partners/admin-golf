<!DOCTYPE html>
<html lang="ko">
<!-- ================================================================ -->
<!-- íŒŒì¼: index.html (ë©”ì¸ í˜ì´ì§€) -->
<!-- ì„¤ëª…: ê³¨í”„ì¥ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ë©”ì¸ í™”ë©´ -->
<!-- ê¸°ëŠ¥: 4ê°œ íƒ­ ë§¤íŠ¸ë¦­ìŠ¤ ë·° (ë°ì¼ë¦¬ë¶€í‚¹/ì¡°ì¸, íŒ¨í‚¤ì§€ë¶€í‚¹/ì¡°ì¸) -->
<!-- ================================================================ -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨í”„ì¥ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <!-- ============ CSS ìŠ¤íƒ€ì¼ ì„¹ì…˜ ì‹œì‘ ============ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            line-height: 1.4;
        }

        /* ê³µí†µ í—¤ë”ì™€ í€µë©”ë‰´ ìŠ¤íƒ€ì¼ì€ components/quick-menu.jsì—ì„œ ìë™ ë¡œë“œë©ë‹ˆë‹¤ */

        /* Container */
        .container {
            padding: 20px 24px;
            max-width: 100%;
            overflow-x: hidden;
        }

        /* ============ ë§¤íŠ¸ë¦­ìŠ¤ ë·° íƒ­ ìŠ¤íƒ€ì¼ ============ */
        /* Matrix View Tabs */
        .matrix-tabs {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #495057;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #e9ecef;
        }

        .tab-button.active {
            color: #007bff;
            background: white;
            border-bottom-color: #007bff;
        }

        /* ============ ë§¤íŠ¸ë¦­ìŠ¤ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ============ */
        /* Matrix Table Container */
        .matrix-container {
            background: white;
            min-height: 400px;
            overflow-x: auto;
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            table-layout: fixed;
        }

        /* Fixed Headers */
        .matrix-table th {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Header specific widths */
        .matrix-table th.region-col {
            position: sticky;
            left: 0;
            width: 80px;
            min-width: 80px;
            z-index: 15;
            background: #f8f9fa;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table th.golf-course-col {
            position: sticky;
            left: 80px;
            width: 150px;
            min-width: 150px;
            z-index: 14;
            background: #f8f9fa;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        /* Fixed Left Columns */
        .matrix-table .region-col {
            position: sticky;
            left: 0;
            width: 80px;
            min-width: 80px;
            z-index: 6;
            background: #fff;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table .golf-course-col {
            position: sticky;
            left: 80px;
            width: 150px;
            min-width: 150px;
            z-index: 5;
            background: #fff;
            border-right: 2px solid #007bff;
            box-shadow: 2px 0 5px rgba(0,123,255,0.1);
        }

        .matrix-table td {
            border: 1px solid #dee2e6;
            padding: 4px;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
        }

        /* Date Columns */
        .date-col {
            width: 120px;
            min-width: 120px;
        }

        /* Time Slot Badges */
        .time-slots {
            display: flex;
            justify-content: space-between;
            gap: 2px;
            width: 100%;
        }

        .time-slot {
            flex: 1;
            background: #e9ecef;
            color: #495057;
            padding: 8px 4px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 32px;
            text-align: center;
            border: 1px solid transparent;
        }

        .time-slot:hover {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        .time-slot.has-data {
            background: #28a745;
            color: white;
            border-color: #1e7e34;
            font-weight: 600;
        }

        .time-slot.has-data:hover {
            background: #1e7e34;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(40,167,69,0.4);
        }

        /* Row styling */
        .matrix-table tr:hover td:not(.region-col):not(.golf-course-col) {
            background-color: #f8f9fa;
        }

        /* Region grouping */
        .region-group {
            border-top: 2px solid #007bff;
        }

        .region-group:first-child {
            border-top: none;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Status indicators */
        .status-info {
            padding: 12px 24px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .global-header {
                padding: 8px 12px;
                flex-direction: column;
                gap: 8px;
            }

            .quick-menu {
                padding: 8px 12px;
            }

            .container {
                padding: 12px;
            }

            .tab-button {
                padding: 12px 8px;
                font-size: 13px;
            }

            .matrix-container {
                min-height: 300px;
            }
        }
    </style>
    <!-- ============ CSS ìŠ¤íƒ€ì¼ ì„¹ì…˜ ë ============ -->
</head>
<body>
    <!-- ============ HTML BODY ì„¹ì…˜ ì‹œì‘ ============ -->
    <!-- ê³µí†µ í—¤ë”ì™€ í€µë©”ë‰´ëŠ” JavaScriptë¡œ ìë™ ìƒì„±ë©ë‹ˆë‹¤ -->

    <!-- ============ ë©”ì¸ ì»¨í…Œì´ë„ˆ ì„¹ì…˜ ============ -->
    <!-- Main Container -->
    <div class="container">
        <!-- ============ ë§¤íŠ¸ë¦­ìŠ¤ ë·° íƒ­ ì„¹ì…˜ ============ -->
        <!-- Matrix View Tabs -->
        <div class="matrix-tabs">
            <!-- ============ íƒ­ ë²„íŠ¼ ì˜ì—­ ============ -->
            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchMatrixTab('daily-booking')">ë°ì¼ë¦¬ë¶€í‚¹</button>
                <button class="tab-button" onclick="switchMatrixTab('daily-join')">ë°ì¼ë¦¬ì¡°ì¸</button>
                <button class="tab-button" onclick="switchMatrixTab('package-booking')">íŒ¨í‚¤ì§€ë¶€í‚¹</button>
                <button class="tab-button" onclick="switchMatrixTab('package-join')">íŒ¨í‚¤ì§€ì¡°ì¸</button>
            </div>

            <!-- ============ íƒ­ ì»¨í…ì¸  ì˜ì—­ ============ -->
            <!-- Tab Contents -->
            <div id="daily-booking" class="tab-content active">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">ì§€ì—­</th>
                                <th class="golf-course-col">ê³¨í”„ì¥</th>
                                <th class="date-col">ì˜¤ëŠ˜<br>01/09</th>
                                <th class="date-col">ë‚´ì¼<br>01/10</th>
                                <th class="date-col">ëª¨ë ˆ<br>01/11</th>
                                <th class="date-col">01/12<br>í† </th>
                                <th class="date-col">01/13<br>ì¼</th>
                                <th class="date-col">01/14<br>ì›”</th>
                                <th class="date-col">01/15<br>í™”</th>
                                <!-- 90ì¼ê¹Œì§€ ë™ì  ìƒì„± -->
                            </tr>
                        </thead>
                        <tbody id="matrix-body-daily-booking">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="daily-join" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">ì§€ì—­</th>
                                <th class="golf-course-col">ê³¨í”„ì¥</th>
                                <th class="date-col">ì˜¤ëŠ˜<br>01/09</th>
                                <th class="date-col">ë‚´ì¼<br>01/10</th>
                                <th class="date-col">ëª¨ë ˆ<br>01/11</th>
                                <th class="date-col">01/12<br>í† </th>
                                <th class="date-col">01/13<br>ì¼</th>
                                <th class="date-col">01/14<br>ì›”</th>
                                <th class="date-col">01/15<br>í™”</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-daily-join">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="package-booking" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">ì§€ì—­</th>
                                <th class="golf-course-col">ê³¨í”„ì¥</th>
                                <th class="date-col">ì˜¤ëŠ˜<br>01/09</th>
                                <th class="date-col">ë‚´ì¼<br>01/10</th>
                                <th class="date-col">ëª¨ë ˆ<br>01/11</th>
                                <th class="date-col">01/12<br>í† </th>
                                <th class="date-col">01/13<br>ì¼</th>
                                <th class="date-col">01/14<br>ì›”</th>
                                <th class="date-col">01/15<br>í™”</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-package-booking">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="package-join" class="tab-content">
                <div class="matrix-container">
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th class="region-col">ì§€ì—­</th>
                                <th class="golf-course-col">ê³¨í”„ì¥</th>
                                <th class="date-col">ì˜¤ëŠ˜<br>01/09</th>
                                <th class="date-col">ë‚´ì¼<br>01/10</th>
                                <th class="date-col">ëª¨ë ˆ<br>01/11</th>
                                <th class="date-col">01/12<br>í† </th>
                                <th class="date-col">01/13<br>ì¼</th>
                                <th class="date-col">01/14<br>ì›”</th>
                                <th class="date-col">01/15<br>í™”</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body-package-join">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Status Info -->
            <div class="status-info">
                <span id="matrix-stats">ì´ 0ê°œ ê³¨í”„ì¥ â€¢ 0ê°œ í‹°íƒ€ì„</span>
                <span>í¬íŠ¸ 5555 PostgreSQL â€¢ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸</span>
            </div>
        </div>
    </div>

    <!-- ============ JavaScript ì„¹ì…˜ ì‹œì‘ ============ -->
    <!-- ê³µí†µ í€µë©”ë‰´ ì»´í¬ë„ŒíŠ¸ -->
    <script src="components/quick-menu.js"></script>
    <script>
        // í˜„ì¬ í™œì„± íƒ­
        let currentMatrixTab = 'daily-booking';
        
        // ë™ì  ë°ì´í„° ì €ì¥ì†Œ
        let ê³¨í”„ì¥ë°ì´í„° = {};
        let ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„° = {};
        let í˜„ì¬ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„° = null;  // í´ë¦­ ì´ë²¤íŠ¸ìš© í˜„ì¬ í™œì„± ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„°
        let ë‚ ì§œë°°ì—´ = [];

        // ë‚ ì§œ ìƒì„± (90ì¼)
        function ë‚ ì§œìƒì„±() {
            const dates = [];
            const today = new Date();
            
            for (let i = 0; i < 90; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const weekDay = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                
                dates.push({
                    display: i === 0 ? 'ì˜¤ëŠ˜' : i === 1 ? 'ë‚´ì¼' : i === 2 ? 'ëª¨ë ˆ' : `${month}/${day}`,
                    subDisplay: i < 3 ? `${month}/${day}` : weekDay,
                    fullDate: date.toISOString().split('T')[0]
                });
            }
            
            return dates;
        }

        // APIì—ì„œ ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ
        async function ê³¨í”„ì¥ë°ì´í„°ë¡œë“œ() {
            try {
                const response = await fetch('http://localhost:3001/api/golf-courses');
                if (response.ok) {
                    ê³¨í”„ì¥ë°ì´í„° = await response.json();
                    console.log('ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', ê³¨í”„ì¥ë°ì´í„°);
                } else {
                    console.error('ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    ê³¨í”„ì¥ë°ì´í„° = {};
                }
            } catch (error) {
                console.error('ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                ê³¨í”„ì¥ë°ì´í„° = {};
            }
        }

        // localStorageì—ì„œ í‹°íƒ€ì„ ë°ì´í„° ë¡œë“œ
        function localStorageì—ì„œí‹°íƒ€ì„ë°ì´í„°ë¡œë“œ() {
            try {
                const savedTeeTimes = localStorage.getItem('savedTeeTimes');
                if (!savedTeeTimes) {
                    console.log('ğŸ“‚ localStorageì— ì €ì¥ëœ í‹°íƒ€ì„ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return [];
                }
                
                const parsedData = JSON.parse(savedTeeTimes);
                console.log(`ğŸ“‚ localStorageì—ì„œ ${parsedData.length}ê°œ í‹°íƒ€ì„ ë¡œë“œë¨:`, parsedData);
                return parsedData;
            } catch (error) {
                console.error('âŒ localStorage í‹°íƒ€ì„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                return [];
            }
        }

        // í‹°íƒ€ì„ ë°ì´í„°ë¥¼ ë¶€í‚¹ ìœ í˜•ë³„ë¡œ ë¶„ë¥˜
        function í‹°íƒ€ì„ë°ì´í„°ë¶„ë¥˜(teeTimeData) {
            const classified = {
                'daily-booking': [],
                'daily-join': [],
                'package-booking': [],
                'package-join': []
            };
            
            teeTimeData.forEach(teeTime => {
                // ì¸ì› ìˆ˜ì— ë”°ë¥¸ ë¶€í‚¹/ì¡°ì¸ ë¶„ë¥˜
                const players = parseInt(teeTime.players) || 0;
                const isBooking = players >= 4;
                const isJoin = players < 4 && players > 0;
                
                // íŒ¨í‚¤ì§€ ì—¬ë¶€ í™•ì¸ (ê¸°íƒ€ í•„ë“œì— 'íŒ¨í‚¤ì§€' í¬í•¨ ì—¬ë¶€ë¡œ ì„ì‹œ êµ¬ë¶„)
                const isPackage = teeTime.other && teeTime.other.includes('íŒ¨í‚¤ì§€');
                
                if (isPackage) {
                    if (isBooking) classified['package-booking'].push(teeTime);
                    else if (isJoin) classified['package-join'].push(teeTime);
                } else {
                    if (isBooking) classified['daily-booking'].push(teeTime);
                    else if (isJoin) classified['daily-join'].push(teeTime);
                }
            });
            
            console.log('ğŸ“Š í‹°íƒ€ì„ ë¶„ë¥˜ ê²°ê³¼:', {
                'daily-booking': classified['daily-booking'].length,
                'daily-join': classified['daily-join'].length,
                'package-booking': classified['package-booking'].length,
                'package-join': classified['package-join'].length
            });
            
            return classified;
        }

        // localStorage ë°ì´í„°ë¥¼ ë§¤íŠ¸ë¦­ìŠ¤ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function localStorageë°ì´í„°ë¥¼ë§¤íŠ¸ë¦­ìŠ¤ë¡œë³€í™˜(classifiedData, tabName) {
            const teeTimesForTab = classifiedData[tabName] || [];
            
            // ê³¨í”„ì¥ë³„ ê·¸ë£¹í™”
            const golfCourseGroups = {};
            teeTimesForTab.forEach(teeTime => {
                const golfCourse = teeTime.golfCourse || 'ë¯¸ì§€ì •';
                if (!golfCourseGroups[golfCourse]) {
                    golfCourseGroups[golfCourse] = [];
                }
                golfCourseGroups[golfCourse].push(teeTime);
            });
            
            // ë§¤íŠ¸ë¦­ìŠ¤ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const matrix = [];
            Object.entries(golfCourseGroups).forEach(([golfCourse, teeTimes]) => {
                // ì§€ì—­ ì •ë³´ ì¶”ì¶œ (ì²« ë²ˆì§¸ í‹°íƒ€ì„ì—ì„œ)
                const region = teeTimes[0]?.region || 'ë¯¸ì§€ì •';
                
                // ë‚ ì§œë³„ ì‹œê°„ëŒ€ë³„ ì§‘ê³„
                const dates = {};
                teeTimes.forEach(teeTime => {
                    const date = teeTime.date;
                    const time = teeTime.time || '0000';
                    const hour = parseInt(time.substring(0, 2)) || 0;
                    
                    // ì‹œê°„ëŒ€ ë¶„ë¥˜
                    let timePart = '2ë¶€'; // ê¸°ë³¸ê°’
                    if (hour < 10) timePart = '1ë¶€';
                    else if (hour >= 15) timePart = '3ë¶€';
                    
                    if (!dates[date]) {
                        dates[date] = { '1ë¶€': 0, '2ë¶€': 0, '3ë¶€': 0 };
                    }
                    dates[date][timePart]++;
                });
                
                matrix.push({
                    golfCourse,
                    region,
                    dates
                });
            });
            
            return matrix;
        }

        // APIì—ì„œ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ (íƒ­ë³„ í•„í„°ë§)
        async function ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°ë¡œë“œ(tabName) {
            // 1. APIì—ì„œ í‹°íƒ€ì„ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ
            let apiMatrixData = {};
            try {
                const response = await fetch('http://localhost:3001/api/tee-time-matrix');
                if (response.ok) {
                    apiMatrixData = await response.json();
                    console.log(`âœ… API ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${tabName}):`, Object.keys(apiMatrixData).length, 'ê°œ ê³¨í”„ì¥');
                } else {
                    console.log('âš ï¸ API ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                    apiMatrixData = {};
                }
            } catch (error) {
                console.log('âš ï¸ API ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error.message);
                apiMatrixData = {};
            }
            
            // 2. íƒ­ë³„ í•„í„°ë§ëœ ë°ì´í„° ìƒì„±
            const filteredMatrix = [];
            Object.entries(apiMatrixData).forEach(([courseKey, courseData]) => {
                const filteredDates = {};
                
                // ê° ë‚ ì§œë³„ë¡œ í•´ë‹¹ íƒ­ì— ë§ëŠ” ë°ì´í„°ë§Œ ì¶”ì¶œ
                Object.entries(courseData.dates).forEach(([date, dateData]) => {
                    filteredDates[date] = { part1: 0, part2: 0, part3: 0 };
                    
                    // íƒ­ë³„ë¡œ í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ ì§‘ê³„
                    if (tabName === 'daily-booking') {
                        filteredDates[date].part1 = dateData.ë¶€í‚¹_part1 || 0;
                        filteredDates[date].part2 = dateData.ë¶€í‚¹_part2 || 0;
                        filteredDates[date].part3 = dateData.ë¶€í‚¹_part3 || 0;
                    } else if (tabName === 'daily-join') {
                        filteredDates[date].part1 = dateData.ì¡°ì¸_part1 || 0;
                        filteredDates[date].part2 = dateData.ì¡°ì¸_part2 || 0;
                        filteredDates[date].part3 = dateData.ì¡°ì¸_part3 || 0;
                    } else if (tabName === 'package-booking') {
                        filteredDates[date].part1 = dateData.íŒ¨í‚¤ì§€_part1 || 0;
                        filteredDates[date].part2 = dateData.íŒ¨í‚¤ì§€_part2 || 0;
                        filteredDates[date].part3 = dateData.íŒ¨í‚¤ì§€_part3 || 0;
                    } else if (tabName === 'package-join') {
                        // íŒ¨í‚¤ì§€ì¡°ì¸ì€ í˜„ì¬ ë³„ë„ êµ¬ë¶„ì´ ì—†ì–´ì„œ 0ìœ¼ë¡œ ì²˜ë¦¬ (ì¶”í›„ í™•ì¥ ê°€ëŠ¥)
                        filteredDates[date].part1 = 0;
                        filteredDates[date].part2 = 0;
                        filteredDates[date].part3 = 0;
                    }
                });
                
                filteredMatrix.push({
                    golfCourse: courseData.courseName,
                    region: courseData.region,
                    dates: filteredDates
                });
            });
            
            // 3. ë‚ ì§œ ë°°ì—´ ìƒì„± (90ì¼)
            const dates = ë‚ ì§œìƒì„±().map(d => d.fullDate);
            
            // 4. ìµœì¢… ë°ì´í„° ì €ì¥
            ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°[tabName] = {
                dates: dates,
                matrix: filteredMatrix
            };
            í˜„ì¬ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„° = ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°[tabName];
            ë‚ ì§œë°°ì—´ = dates;
            
            console.log(`ğŸ”„ íƒ­ë³„ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ (${tabName}):`, {
                courses: filteredMatrix.length,
                dates: dates.length
            });
        }

        // íƒ­ë³„ ë§¤íŠ¸ë¦­ìŠ¤ í…Œì´ë¸” ìƒì„± í•¨ìˆ˜
        function ë§¤íŠ¸ë¦­ìŠ¤í…Œì´ë¸”ìƒì„±(tabName) {
            const tbody = document.getElementById(`matrix-body-${tabName}`);
            if (!tbody) {
                console.error(`í…Œì´ë¸” ë°”ë””ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: matrix-body-${tabName}`);
                return;
            }

            const tabData = ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°[tabName];
            if (!tabData || !tabData.matrix || tabData.matrix.length === 0) {
                tbody.innerHTML = '<tr><td colspan="100%" style="text-align: center; padding: 40px; color: #666;">ë°ì´í„°ë¥¼ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...</td></tr>';
                return;
            }

            let html = '';
            let regionCount = 0;
            let golfCourseCount = 0;
            let totalTeeTimeCount = 0;
            const processedRegions = new Set();

            // ì§€ì—­ë³„ ê·¸ë£¹í™”
            const regionGroups = {};
            tabData.matrix.forEach(item => {
                if (!regionGroups[item.region]) {
                    regionGroups[item.region] = [];
                }
                regionGroups[item.region].push(item);
            });

            Object.entries(regionGroups).forEach(([region, courses]) => {
                if (!processedRegions.has(region)) {
                    regionCount++;
                    processedRegions.add(region);
                }

                courses.forEach((course, index) => {
                    golfCourseCount++;
                    html += `<tr class="${index === 0 ? 'region-group' : ''}">`;
                    
                    // ì§€ì—­ ì¹¼ëŸ¼ (ì²« ë²ˆì§¸ ê³¨í”„ì¥ì—ì„œë§Œ í‘œì‹œ)
                    if (index === 0) {
                        html += `<td class="region-col" rowspan="${courses.length}">${region}</td>`;
                    }
                    
                    // ê³¨í”„ì¥ ì¹¼ëŸ¼
                    html += `<td class="golf-course-col">${course.golfCourse}</td>`;
                    
                    // ë‚ ì§œë³„ ì‹œê°„ëŒ€ ì¹¼ëŸ¼ë“¤
                    ë‚ ì§œë°°ì—´.forEach(date => {
                        const dateSlots = course.dates[date] || { part1: 0, part2: 0, part3: 0 };
                        
                        const part1Count = dateSlots.part1 || 0;
                        const part2Count = dateSlots.part2 || 0;
                        const part3Count = dateSlots.part3 || 0;
                        
                        totalTeeTimeCount += part1Count + part2Count + part3Count;
                        
                        html += `<td class="date-col">
                            <div class="time-slots">
                                <div class="time-slot ${part1Count > 0 ? 'has-data' : ''}" 
                                     onclick="ìƒì„¸í˜ì´ì§€ì´ë™('${course.golfCourse}', '${date}', '1ë¶€', '${tabName}')"
                                     title="1ë¶€: ${part1Count}ê°œ">
                                     ${part1Count}
                                </div>
                                <div class="time-slot ${part2Count > 0 ? 'has-data' : ''}" 
                                     onclick="ìƒì„¸í˜ì´ì§€ì´ë™('${course.golfCourse}', '${date}', '2ë¶€', '${tabName}')"
                                     title="2ë¶€: ${part2Count}ê°œ">
                                     ${part2Count}
                                </div>
                                <div class="time-slot ${part3Count > 0 ? 'has-data' : ''}" 
                                     onclick="ìƒì„¸í˜ì´ì§€ì´ë™('${course.golfCourse}', '${date}', '3ë¶€', '${tabName}')"
                                     title="3ë¶€: ${part3Count}ê°œ">
                                     ${part3Count}
                                </div>
                            </div>
                        </td>`;
                    });
                    
                    html += '</tr>';
                });
            });
            
            tbody.innerHTML = html;
            
            // í†µê³„ ì—…ë°ì´íŠ¸ (í˜„ì¬ í™œì„± íƒ­ì—ì„œë§Œ)
            if (tabName === currentMatrixTab) {
                document.getElementById('matrix-stats').textContent = 
                    `ì´ ${golfCourseCount}ê°œ ê³¨í”„ì¥ â€¢ ${totalTeeTimeCount}ê°œ í‹°íƒ€ì„`;
            }
        }


        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchMatrixTab(tabName) {
            console.log(`ğŸ”„ íƒ­ ì „í™˜: ${tabName}`);
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // íƒ­ ì»¨í…ì¸  í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            // í˜„ì¬ í™œì„± íƒ­ ì—…ë°ì´íŠ¸
            currentMatrixTab = tabName;
            
            // í•´ë‹¹ íƒ­ì˜ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ ë° í…Œì´ë¸” ìƒì„±
            ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°ë¡œë“œ(tabName).then(() => {
                ë§¤íŠ¸ë¦­ìŠ¤í…Œì´ë¸”ìƒì„±(tabName);
            });
        }

        // ìƒì„¸ í˜ì´ì§€ ì´ë™
        function ìƒì„¸í˜ì´ì§€ì´ë™(golfCourse, date, timePart, tabName) {
            // íƒ­ë³„ type ë§¤í•‘
            const typeMap = {
                'daily-booking': 'booking',
                'daily-join': 'join', 
                'package-booking': 'package',
                'package-join': 'package'  // íŒ¨í‚¤ì§€ì¡°ì¸ì€ íŒ¨í‚¤ì§€ë¡œ ì²˜ë¦¬
            };
            
            const type = typeMap[tabName] || 'all';
            
            // ì§€ì—­ ì •ë³´ë¥¼ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„°ì—ì„œ ì°¾ê¸°
            let region = '';
            const tabData = ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°[tabName];
            if (tabData && tabData.matrix) {
                const courseData = tabData.matrix.find(item => 
                    item.golfCourse === golfCourse
                );
                if (courseData) {
                    region = courseData.region;
                }
            }
            
            // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
            const params = new URLSearchParams({
                golfCourse: golfCourse,
                region: region,
                date: date,
                timePart: timePart,
                type: type
            });
            
            // í‹°íƒ€ì„ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = `tee-time-list.html?${params.toString()}`;
        }

        // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê´€ë ¨ í•¨ìˆ˜ë“¤ì€ ê³µí†µ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸŒï¸ ê³¨í”„ì¥ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
            
            // ê³µí†µ ë ˆì´ì•„ì›ƒì´ ë¨¼ì € ë¡œë“œë˜ê¸°ë¥¼ ì ê¹ ê¸°ë‹¤ë¦¼
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // 1. ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ
            await ê³¨í”„ì¥ë°ì´í„°ë¡œë“œ();
            
            // 2. ë‚ ì§œ í—¤ë” ë™ì  ìƒì„±
            const dates = ë‚ ì§œìƒì„±();
            const tableHeaders = document.querySelectorAll('.matrix-table thead tr');
            
            tableHeaders.forEach(header => {
                // ê¸°ì¡´ ë‚ ì§œ ì»¬ëŸ¼ ì œê±° (ì²˜ìŒ 2ê°œëŠ” ì§€ì—­/ê³¨í”„ì¥ ì»¬ëŸ¼)
                const existingDateCols = header.querySelectorAll('.date-col');
                existingDateCols.forEach(col => col.remove());
                
                // ìƒˆ ë‚ ì§œ ì»¬ëŸ¼ ì¶”ê°€
                dates.forEach(dateInfo => {
                    const th = document.createElement('th');
                    th.className = 'date-col';
                    th.innerHTML = `${dateInfo.display}<br>${dateInfo.subDisplay}`;
                    header.appendChild(th);
                });
            });
            
            // 3. ì´ˆê¸° íƒ­ ë°ì´í„° ë¡œë“œ (ë°ì¼ë¦¬ë¶€í‚¹ë¶€í„° ì‹œì‘)
            console.log('ì´ˆê¸° ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„° ë¡œë“œ ì¤‘...');
            await ë§¤íŠ¸ë¦­ìŠ¤ë°ì´í„°ë¡œë“œ(currentMatrixTab);
            ë§¤íŠ¸ë¦­ìŠ¤í…Œì´ë¸”ìƒì„±(currentMatrixTab);
            
            console.log('âœ… ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>
    <!-- ============ JavaScript ì„¹ì…˜ ë ============ -->
</body>
<!-- ============ HTML ë¬¸ì„œ ë ============ -->
</html>