<!DOCTYPE html>
<html lang="ko">
<!-- ================================================================ -->
<!-- íŒŒì¼: tee-time-register.html (í•œ ì¤„ì”© í‹°íƒ€ì„ ë“±ë¡ ì‹œìŠ¤í…œ) -->
<!-- ì„¤ëª…: ì—‘ì…€ê³¼ ê°™ì€ í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ê³¼ ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ -->
<!-- ê¸°ëŠ¥: ììŒëª¨ìŒ ê³¨í”„ì¥ ê²€ìƒ‰, Tab/Space/Enter í‚¤ë³´ë“œ ì œì–´, ìë™ ì €ì¥ -->
<!-- ================================================================ -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨í”„ì¥ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ - í‹°íƒ€ì„ ë“±ë¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            line-height: 1.4;
        }

        /* ============ ì „ì—­ í—¤ë” ìŠ¤íƒ€ì¼ ============ */
        .global-header {
            background: linear-gradient(135deg, #2c5282 0%, #2b6cb0 100%);
            color: white;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
        }

        .company-name {
            font-size: 18px;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }

        .notification-icon {
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .notification-icon:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .user-profile {
            color: rgba(255,255,255,0.9);
        }

        .login-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* ============ í€µ ë©”ë‰´ ìŠ¤íƒ€ì¼ ============ */
        .quick-menu {
            background: white;
            padding: 12px 24px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            gap: 20px;
            overflow-x: auto;
        }

        .menu-item {
            white-space: nowrap;
            padding: 8px 16px;
            background: #f8f9fa;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #495057;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: #e9ecef;
        }

        .menu-item.active {
            background: #007bff;
            color: white;
        }

        .container {
            padding: 20px;
        }

        .header {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 22px;
        }

        .back-btn {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: #545b62;
        }

        .info-panel {
            background: #e3f2fd;
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .info-panel h3 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .info-panel .controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 13px;
            color: #1565c0;
        }

        .control-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .key-badge {
            background: #1976d2;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
        }

        .tee-time-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-weight: 600;
            color: #495057;
        }

        .status-info {
            font-size: 14px;
            color: #6c757d;
        }

        .table-wrapper {
            overflow: auto;
            max-height: 70vh;
        }

        .tee-time-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
        }

        .tee-time-table th {
            background: #f1f3f4;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            color: #333;
            border: 1px solid #d1d3d4;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 12px;
            white-space: nowrap;
        }

        .tee-time-table td {
            padding: 6px 4px;
            border: 1px solid #e1e3e4;
            position: relative;
            background: white;
            text-align: center;
        }

        .tee-time-table tr:hover {
            background-color: #f8f9fa;
        }

        .tee-time-table tr.editing {
            background-color: #fff3cd;
        }

        .tee-time-table tr.completed {
            background-color: #d1edff;
        }

        .cell-input, .cell-select {
            width: 100%;
            padding: 6px 8px;
            border: none;
            background: transparent;
            font-size: 12px;
            outline: none;
            text-align: center;
        }

        .cell-input:focus, .cell-select:focus {
            background: #fff3cd;
            box-shadow: inset 0 0 0 2px #ffc107;
            border-radius: 3px;
        }

        .cell-input.auto-fill {
            background: #e8f5e8;
            color: #155724;
            font-weight: 500;
        }

        .cell-input.invalid {
            background: #f8d7da;
            color: #721c24;
        }

        .golf-course-input {
            position: relative;
        }

        .golf-course-dropdown {
            position: fixed; /* fixedë¡œ ë³€ê²½í•˜ì—¬ ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            top: 100%;
            left: 0;
            right: auto;
            width: 250px; /* ê³ ì • ë„ˆë¹„ ì„¤ì • */
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 99999; /* ë” ë†’ì€ z-index */
            display: none;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25); /* ë” ê°•í•œ ê·¸ë¦¼ì */
            border-top: 2px solid #007bff; /* ìƒë‹¨ í…Œë‘ë¦¬ë¡œ ì‹œê°ì  êµ¬ë¶„ ê°•í™” */
        }

        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .dropdown-item.selected {
            background: #e3f2fd;
            color: #1976d2;
        }

        .action-btn {
            padding: 4px 8px;
            margin: 0 2px;
            border: 1px solid #ddd;
            background: #f8f9fa;
            color: #333;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .action-btn.add {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .action-btn.add:hover {
            background: #218838;
        }

        .action-btn.book {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .action-btn.book:hover {
            background: #0056b3;
        }

        .action-btn.delete {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .action-btn.delete:hover {
            background: #c82333;
        }

        .status-messages {
            margin-bottom: 15px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: none;
            font-size: 14px;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ì»¬ëŸ¼ ë„ˆë¹„ */
        .col-no { width: 40px; }
        .col-region { width: 60px; display: none; } /* ì§€ì—­ í•„ë“œ ìˆ¨ê¹€ */
        .col-golf-course { width: 180px; } /* ê³¨í”„ì¥ í•„ë“œ ë„ˆë¹„ í™•ì¥ */
        .col-date { width: 80px; }
        .col-time { width: 70px; }
        .col-green-fee { width: 80px; }
        .col-players { width: 80px; }
        .col-request { width: 80px; }
        .col-hole { width: 60px; }
        .col-caddy { width: 90px; }
        .col-prepay { width: 60px; }
        .col-meal { width: 80px; }
        .col-cart { width: 60px; }
        .col-other { width: 120px; }
        .col-actions { width: 100px; }

        /* í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í•˜ì´ë¼ì´íŠ¸ */
        .cell-focused {
            box-shadow: inset 0 0 0 3px #007bff !important;
        }
        
        /* ì €ì¥ ì™„ë£Œëœ í–‰ ìŠ¤íƒ€ì¼ */
        .saved {
            background-color: #f8f9fa;
        }
        
        .saved .cell-input,
        .saved .cell-select {
            background-color: #e9ecef;
            border-color: #ced4da;
            border-radius: 3px;
        }

        /* ì €ì¥ ìƒíƒœ í‘œì‹œ */
        .saving {
            position: relative;
        }

        .saving::after {
            content: "ğŸ’¾";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .auto-complete {
            background: #e8f5e8;
            animation: highlight 0.5s ease-out;
        }

        @keyframes highlight {
            0% { background: #ffc107; }
            100% { background: #e8f5e8; }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .info-panel .controls {
                justify-content: center;
            }

            .table-wrapper {
                max-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <!-- ============ ê¸€ë¡œë²Œ í—¤ë” ì„¹ì…˜ ============ -->
    <div class="global-header">
        <div class="header-left">
            <div class="logo">ğŸŒï¸</div>
            <div class="company-name">ê³¨í”„ì¥ ì˜ˆì•½ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
        </div>
        <div class="header-right">
            <div class="notification-icon">ğŸ””</div>
            <div class="user-profile">ê´€ë¦¬ì (01034424668)</div>
            <button class="login-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ============ í€µ ë©”ë‰´ ì„¹ì…˜ ============ -->
    <div class="quick-menu">
        <button class="menu-item" onclick="location.href='index.html'">í‹°íƒ€ì„:ëª¨ë‘</button>
        <button class="menu-item active">í‹°íƒ€ì„ë“±ë¡:ë§¤ë‹ˆì €ì´ìƒ</button>
        <button class="menu-item" onclick="location.href='golf-courses.html'">ê³¨í”„ì¥ë¦¬ìŠ¤íŠ¸/ë“±ë¡:ê´€ë¦¬ìì´ìƒ</button>
        <button class="menu-item">ì‹¤ì ë“±ë¡:ë§¤ë‹ˆì €ì´ìƒ</button>
        <button class="menu-item">íšŒì›ê´€ë¦¬:ê´€ë¦¬ìì´ìƒ</button>
    </div>

    <!-- ============ ë©”ì¸ ì»¨í…Œì´ë„ˆ ============ -->
    <div class="container">
        <div class="header">
            <h1>ğŸŒï¸ í‹°íƒ€ì„ ë“±ë¡ ì‹œìŠ¤í…œ</h1>
            <a href="/" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
        </div>

    <div class="info-panel">
        <h3>âŒ¨ï¸ í‚¤ë³´ë“œ ì œì–´ ê°€ì´ë“œ</h3>
        <div class="controls">
            <div class="control-item">
                <span class="key-badge">Tab</span>
                <span>ë‹¤ìŒ í•„ë“œë¡œ ì´ë™</span>
            </div>
            <div class="control-item">
                <span class="key-badge">Space</span>
                <span>ì„ íƒ í•­ëª©ì—ì„œ ë‹¤ìŒìœ¼ë¡œ</span>
            </div>
            <div class="control-item">
                <span class="key-badge">Enter</span>
                <span>í˜„ì¬ í–‰ ì €ì¥ í›„ ìƒˆ í–‰ ì¶”ê°€</span>
            </div>
            <div class="control-item">
                <span class="key-badge">ESC</span>
                <span>ì…ë ¥ ì·¨ì†Œ</span>
            </div>
            <div class="control-item">
                <span class="key-badge">ììŒëª¨ìŒ</span>
                <span>ê³¨í”„ì¥ ìë™ê²€ìƒ‰</span>
            </div>
        </div>
    </div>

    <div class="status-messages">
        <div class="message success" id="successMessage"></div>
        <div class="message error" id="errorMessage"></div>
        <div class="message info" id="infoMessage"></div>
    </div>

    <div class="tee-time-container">
        <div class="table-header">
            <span class="table-title">í‹°íƒ€ì„ ë“±ë¡</span>
            <span class="status-info">ë“±ë¡ëœ í‹°íƒ€ì„: <span id="totalCount">0</span>ê°œ</span>
        </div>

        <div class="table-wrapper">
            <table class="tee-time-table" id="teeTimeTable">
                <thead>
                    <tr>
                        <th class="col-no">ë²ˆí˜¸</th>
                        <th class="col-region" style="display: none;">ì§€ì—­</th>
                        <th class="col-golf-course">ê³¨í”„ì¥</th>
                        <th class="col-date">í‹°ì—…(ë‚ ì§œ)</th>
                        <th class="col-time">í‹°ì—…(ì‹œê°„)</th>
                        <th class="col-green-fee">ê·¸ë¦°í”¼(ë§Œì›)</th>
                        <th class="col-players">ìš”ì²­ì¸ì›</th>
                        <th class="col-request">ìš”ì²­ì‚¬í•­</th>
                        <th class="col-hole">í™€ì„ íƒ</th>
                        <th class="col-caddy">ìºë””</th>
                        <th class="col-prepay">ì„ ì…ê¸ˆ</th>
                        <th class="col-meal">ì‹ì‚¬</th>
                        <th class="col-cart">ì¹´íŠ¸ë¹„í¬í•¨</th>
                        <th class="col-other">ê¸°íƒ€</th>
                        <th class="col-actions">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="teeTimeBody">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í–‰ë“¤ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let golfCourses = {};
        let currentDropdownIndex = -1; // ë“œë¡­ë‹¤ìš´ ì„ íƒëœ ì¸ë±ìŠ¤
        let currentDropdownResults = []; // í˜„ì¬ í‘œì‹œëœ ê²€ìƒ‰ ê²°ê³¼
        let currentEditingRow = null;
        let totalTeeTimeCount = 0;
        let rowCounter = 0;
        let currentFocusedCell = null;

        // ê¸°ë³¸ê°’ ì„¤ì •
        const defaultValues = {
            request: 'ë¬´ê´€',
            hole: '18í™€',
            caddy: 'ìºë””',
            prepay: 'O',
            meal: 'í¬í•¨',
            cart: 'O'
        };

        // ì„ íƒ ì˜µì…˜ ë°ì´í„°
        const selectOptions = {
            request: ['ë¬´ê´€', 'ì»¤í”Œ', 'ë‚¨ì„±', 'ì—¬ì„±'],
            hole: ['18í™€', '36í™€', '9í™€'],
            caddy: ['ìºë””', 'ë…¸ìºë””', 'ìš´ì „ìºë””', 'êµìœ¡ìƒìºë””'],
            prepay: ['O', 'X'],
            meal: ['í¬í•¨', 'ë¶ˆí¬í•¨'],
            cart: ['O', 'X']
        };

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(type, text) {
            hideAllMessages();
            const messageEl = document.getElementById(type + 'Message');
            if (messageEl) {
                messageEl.textContent = text;
                messageEl.style.display = 'block';
                
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, type === 'error' ? 5000 : 3000);
            }
        }

        function hideAllMessages() {
            document.querySelectorAll('.message').forEach(msg => {
                msg.style.display = 'none';
            });
        }

        // ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ
        async function loadGolfCourses() {
            try {
                const response = await fetch('/api/golf-courses');
                if (response.ok) {
                    golfCourses = await response.json();
                    console.log('ê³¨í”„ì¥ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', golfCourses);
                } else {
                    showMessage('error', 'ê³¨í”„ì¥ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê³¨í”„ì¥ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage('error', 'ê³¨í”„ì¥ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ììŒëª¨ìŒ ê¸°ë°˜ ê³¨í”„ì¥ ê²€ìƒ‰ (ê°œì„ ëœ ë²„ì „)
        function searchGolfCourses(query) {
            if (!query || query.length < 1) return [];
            
            const results = [];
            const queryLower = query.toLowerCase();
            
            Object.keys(golfCourses).forEach(region => {
                golfCourses[region].forEach(course => {
                    const courseName = course.name.toLowerCase();
                    
                    // ì •í™•íˆ í¬í•¨ëœ ê²½ìš° (ìš°ì„ ìˆœìœ„ 1)
                    if (courseName.includes(queryLower)) {
                        results.push({
                            id: course.id,
                            name: course.name,
                            region: region,
                            status: course.status,
                            priority: 1
                        });
                    }
                    // ììŒ ê²€ìƒ‰ (í•œê¸€) (ìš°ì„ ìˆœìœ„ 2)
                    else if (matchesKoreanConsonants(course.name, query)) {
                        results.push({
                            id: course.id,
                            name: course.name,
                            region: region,
                            status: course.status,
                            priority: 2
                        });
                    }
                });
            });
            
            // ìš°ì„ ìˆœìœ„ë³„ë¡œ ì •ë ¬
            results.sort((a, b) => a.priority - b.priority);
            return results.slice(0, 10); // ìµœëŒ€ 10ê°œ ê²°ê³¼
        }
        
        // í•œê¸€ ììŒ ë§¤ì¹­ í•¨ìˆ˜
        function matchesKoreanConsonants(text, query) {
            // í•œê¸€ ì´ˆì„± ì¶”ì¶œ í•¨ìˆ˜
            function getInitialConsonants(str) {
                const consonants = 'ã„±ã„²ã„´ã„·ã„¸ã„¹ã…ã…‚ã…ƒã……ã…†ã…‡ã…ˆã…‰ã…Šã…‹ã…Œã…ã…';
                let result = '';
                
                for (let i = 0; i < str.length; i++) {
                    const char = str[i];
                    const code = char.charCodeAt(0);
                    
                    if (code >= 0xAC00 && code <= 0xD7AF) { // ì™„ì„±í˜• í•œê¸€
                        const initialIndex = Math.floor((code - 0xAC00) / 588);
                        result += consonants[initialIndex];
                    } else if (consonants.includes(char)) { // ììŒ ìì²´
                        result += char;
                    }
                }
                return result;
            }
            
            const textConsonants = getInitialConsonants(text);
            const queryConsonants = getInitialConsonants(query);
            
            return textConsonants.includes(queryConsonants);
        }

        // ê³¨í”„ì¥ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showGolfCourseDropdown(inputEl, results) {
            // ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            currentDropdownResults = results;
            currentDropdownIndex = -1; // ì„ íƒ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
            
            let dropdown = inputEl.parentElement.querySelector('.golf-course-dropdown');
            
            if (!dropdown) {
                dropdown = document.createElement('div');
                dropdown.className = 'golf-course-dropdown';
                inputEl.parentElement.appendChild(dropdown);
            }
            
            dropdown.innerHTML = '';
            
            if (results.length === 0) {
                dropdown.style.display = 'none';
                return;
            }
            
            results.forEach((course, index) => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                item.textContent = `${course.name} (${course.region})`;
                item.dataset.courseId = course.id;
                item.dataset.courseName = course.name;
                item.dataset.region = course.region;
                
                item.addEventListener('click', () => {
                    selectGolfCourse(inputEl, course);
                    dropdown.style.display = 'none';
                });
                
                dropdown.appendChild(item);
            });
            
            // fixed í¬ì§€ì…˜ì„ ìœ„í•œ ì •í™•í•œ ìœ„ì¹˜ ê³„ì‚°
            const inputRect = inputEl.getBoundingClientRect();
            dropdown.style.top = (inputRect.bottom + window.scrollY) + 'px';
            dropdown.style.left = (inputRect.left + window.scrollX) + 'px';
            dropdown.style.display = 'block';
        }

        // ê³¨í”„ì¥ ìœ íš¨ì„± ê²€ì¦
        function validateGolfCourse(inputValue) {
            // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê³¨í”„ì¥ëª… ì°¾ê¸°
            const exactMatch = Object.values(golfCourses).find(course => course.name === inputValue);
            return exactMatch;
        }

        // ê³¨í”„ì¥ ì„ íƒ
        function selectGolfCourse(inputEl, course) {
            const row = inputEl.closest('tr');
            
            inputEl.value = course.name;
            inputEl.dataset.courseId = course.id;
            inputEl.style.backgroundColor = '#e8f5e8'; // ìœ íš¨í•œ ê³¨í”„ì¥ í‘œì‹œ
            
            // ì§€ì—­ ìë™ ì…ë ¥
            const regionCell = row.querySelector('[data-field="region"]');
            regionCell.value = course.region;
            regionCell.classList.add('auto-fill');
            
            showMessage('info', `${course.name} (${course.region}) ì„ íƒë¨`);
            
            // ë‹¤ìŒ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ì´ë™
            setTimeout(() => {
                focusNextField(inputEl);
            }, 100);
        }

        // ë‚ ì§œ ìë™ ì™„ì„± (MMDD â†’ YYYY-MM-DD)
        function autoCompleteDate(inputEl) {
            let value = inputEl.value.replace(/\D/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ
            
            if (value.length === 4) {
                const currentYear = new Date().getFullYear();
                const month = value.substring(0, 2);
                const day = value.substring(2, 4);
                
                if (month >= '01' && month <= '12' && day >= '01' && day <= '31') {
                    const fullDate = `${currentYear}-${month}-${day}`;
                    inputEl.value = fullDate;
                    inputEl.classList.add('auto-complete');
                    
                    setTimeout(() => {
                        inputEl.classList.remove('auto-complete');
                    }, 500);
                    
                    return true;
                }
            }
            
            return false;
        }

        // ì¸ì›ìˆ˜ ê¸°ë°˜ ë¶€í‚¹/ì¡°ì¸ ìë™ ê²°ì •
        function determineBookingType(players) {
            const numPlayers = parseInt(players);
            
            if (numPlayers === 4) {
                return 'BOOKING';
            } else if (numPlayers >= 1 && numPlayers < 4) {
                return 'JOIN';
            }
            
            return '';
        }

        // ë‹¤ìŒ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ì´ë™
        function focusNextField(currentEl) {
            const row = currentEl.closest('tr');
            const fields = row.querySelectorAll('.cell-input, .cell-select, .action-btn');
            const currentIndex = Array.from(fields).indexOf(currentEl);
            
            if (currentIndex < fields.length - 1) {
                fields[currentIndex + 1].focus();
            }
        }

        // ì´ì „ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ì´ë™
        function focusPreviousField(currentEl) {
            const row = currentEl.closest('tr');
            const fields = row.querySelectorAll('.cell-input, .cell-select, .action-btn');
            const currentIndex = Array.from(fields).indexOf(currentEl);
            
            if (currentIndex > 0) {
                fields[currentIndex - 1].focus();
            }
        }

        // ìƒˆë¡œìš´ í–‰ ì¶”ê°€
        function addNewRow(insertAfter = null) {
            rowCounter++;
            const tbody = document.getElementById('teeTimeBody');
            const today = new Date().toISOString().split('T')[0];
            
            const row = document.createElement('tr');
            row.className = 'editing';
            row.dataset.rowId = rowCounter;
            
            // ì´ì „ í–‰ì˜ ê³¨í”„ì¥ê³¼ ì§€ì—­ ì •ë³´ ë³µì‚¬
            let prevGolfCourse = '';
            let prevRegion = '';
            let prevCourseId = '';
            
            if (insertAfter) {
                const prevGolfCourseEl = insertAfter.querySelector('[data-field="golfCourse"]');
                const prevRegionEl = insertAfter.querySelector('[data-field="region"]');
                
                if (prevGolfCourseEl && prevRegionEl) {
                    prevGolfCourse = prevGolfCourseEl.value;
                    prevRegion = prevRegionEl.value;
                    prevCourseId = prevGolfCourseEl.dataset.courseId || '';
                }
            }
            
            row.innerHTML = `
                <td class="col-no">${rowCounter}</td>
                <td class="col-region" style="display: none;">
                    <input type="text" class="cell-input auto-fill" data-field="region" value="${prevRegion}" readonly>
                </td>
                <td class="col-golf-course">
                    <div class="golf-course-input">
                        <input type="text" class="cell-input" data-field="golfCourse" 
                               value="${prevGolfCourse}" data-course-id="${prevCourseId}" 
                               placeholder="ê³¨í”„ì¥ëª… ì…ë ¥">
                    </div>
                </td>
                <td class="col-date">
                    <input type="text" class="cell-input" data-field="date" 
                           placeholder="MMDD" maxlength="10">
                </td>
                <td class="col-time">
                    <input type="text" class="cell-input" data-field="time" 
                           placeholder="1030" maxlength="4">
                </td>
                <td class="col-green-fee">
                    <input type="number" class="cell-input" data-field="greenFee" 
                           step="0.1" min="0" placeholder="15.5">
                </td>
                <td class="col-players">
                    <input type="number" class="cell-input" data-field="players" 
                           min="1" max="4" placeholder="1-4">
                </td>
                <td class="col-request">
                    <select class="cell-select" data-field="request">
                        ${selectOptions.request.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.request ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-hole">
                    <select class="cell-select" data-field="hole">
                        ${selectOptions.hole.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.hole ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-caddy">
                    <select class="cell-select" data-field="caddy">
                        ${selectOptions.caddy.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.caddy ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-prepay">
                    <select class="cell-select" data-field="prepay">
                        ${selectOptions.prepay.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.prepay ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-meal">
                    <select class="cell-select" data-field="meal">
                        ${selectOptions.meal.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.meal ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-cart">
                    <select class="cell-select" data-field="cart">
                        ${selectOptions.cart.map(opt => 
                            `<option value="${opt}" ${opt === defaultValues.cart ? 'selected' : ''}>${opt}</option>`
                        ).join('')}
                    </select>
                </td>
                <td class="col-other">
                    <input type="text" class="cell-input" data-field="other" 
                           placeholder="ê¸°íƒ€ ë‚´ìš©">
                </td>
                <td class="col-actions">
                    <button class="action-btn add" tabindex="0" onclick="addRowAfter(this)">ì¶”ê°€</button>
                    <button class="action-btn book" tabindex="0">ì˜ˆì•½</button>
                    <button class="action-btn delete" tabindex="0" onclick="deleteRow(this)">ì‚­ì œ</button>
                </td>
            `;
            
            if (insertAfter) {
                insertAfter.insertAdjacentElement('afterend', row);
            } else {
                tbody.appendChild(row);
            }
            
            setupRowEventHandlers(row);
            currentEditingRow = row;
            
            // ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            const firstInput = row.querySelector('.cell-input, .cell-select');
            if (firstInput) {
                firstInput.focus();
            }
            
            return row;
        }

        // í–‰ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupRowEventHandlers(row) {
            const inputs = row.querySelectorAll('.cell-input, .cell-select');
            
            inputs.forEach((input, index) => {
                const field = input.dataset.field;
                
                // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
                input.addEventListener('keydown', (e) => {
                    handleKeyDown(e, input);
                });
                
                // ê³¨í”„ì¥ ê²€ìƒ‰
                if (field === 'golfCourse') {
                    input.addEventListener('input', (e) => {
                        const query = e.target.value;
                        
                        if (query.length >= 1) {
                            const results = searchGolfCourses(query);
                            showGolfCourseDropdown(input, results);
                            
                            // ì •í™•í•œ ê³¨í”„ì¥ëª… ê²€ì¦
                            const validCourse = validateGolfCourse(query);
                            if (validCourse) {
                                input.dataset.courseId = validCourse.id;
                                input.style.backgroundColor = '#e8f5e8'; // ìœ íš¨í•œ ê³¨í”„ì¥ í‘œì‹œ
                                
                                // ì§€ì—­ ìë™ ì…ë ¥
                                const row = input.closest('tr');
                                const regionCell = row.querySelector('[data-field="region"]');
                                regionCell.value = validCourse.region;
                                regionCell.classList.add('auto-fill');
                            } else {
                                input.dataset.courseId = '';
                                input.style.backgroundColor = '#ffeaea'; // ìœ íš¨í•˜ì§€ ì•Šì€ ê³¨í”„ì¥ í‘œì‹œ
                            }
                        } else {
                            const dropdown = input.parentElement.querySelector('.golf-course-dropdown');
                            if (dropdown) dropdown.style.display = 'none';
                            input.style.backgroundColor = '';
                            input.dataset.courseId = '';
                        }
                    });
                    
                    input.addEventListener('blur', (e) => {
                        setTimeout(() => {
                            const dropdown = input.parentElement.querySelector('.golf-course-dropdown');
                            if (dropdown) dropdown.style.display = 'none';
                        }, 200);
                    });
                }
                
                // ë‚ ì§œ ìë™ì™„ì„±
                if (field === 'date') {
                    input.addEventListener('blur', () => {
                        if (input.value.length === 4) {
                            autoCompleteDate(input);
                        }
                    });
                }
                
                // ì¸ì›ìˆ˜ ë³€ê²½ì‹œ ë¶€í‚¹íƒ€ì… ê²°ì •
                if (field === 'players') {
                    input.addEventListener('change', () => {
                        const bookingType = determineBookingType(input.value);
                        showMessage('info', `${input.value}ëª… â†’ ${bookingType === 'BOOKING' ? 'ë¶€í‚¹' : 'ì¡°ì¸'}`);
                    });
                }
                
                
                // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸
                input.addEventListener('focus', () => {
                    currentFocusedCell = input;
                    input.classList.add('cell-focused');
                });
                
                input.addEventListener('blur', () => {
                    input.classList.remove('cell-focused');
                });
            });
            
            // ê´€ë¦¬ ì˜ì—­(ë²„íŠ¼ë“¤)ì— Enter í‚¤ ì´ë²¤íŠ¸ ì¶”ê°€
            const actionButtons = row.querySelectorAll('.action-btn');
            actionButtons.forEach(button => {
                // ë²„íŠ¼ì— tabindex ì¶”ê°€ (í¬ì»¤ìŠ¤ ê°€ëŠ¥í•˜ë„ë¡)
                if (!button.hasAttribute('tabindex')) {
                    button.setAttribute('tabindex', '0');
                }
                
                button.addEventListener('keydown', (e) => {
                    if (e.key === ' ') { // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë³€ê²½
                        e.preventDefault();
                        
                        const currentRow = button.closest('tr');
                        
                        // ì´ë¯¸ ì €ì¥ ì²˜ë¦¬ ì¤‘ì¸ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
                        if (currentRow.dataset.saving === 'true') {
                            return;
                        }
                        
                        // ì €ì¥ ì¤‘ í”Œë˜ê·¸ ì„¤ì •
                        currentRow.dataset.saving = 'true';
                        
                        // í–‰ì„ editing ìƒíƒœë¡œ ì„¤ì • (saveCurrentRowë¥¼ ìœ„í•´)
                        currentRow.classList.add('editing');
                        currentEditingRow = currentRow;
                        
                        console.log('ğŸš€ ìŠ¤í˜ì´ìŠ¤ë°”ì—ì„œ saveCurrentRow í˜¸ì¶œ...');
                        
                        // ì‹¤ì œ ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
                        const success = await saveCurrentRow();
                        
                        if (success) {
                            console.log('âœ… saveCurrentRow ì„±ê³µ');
                            
                            // ì‹œê°ì  í”¼ë“œë°±
                            button.style.backgroundColor = '#28a745';
                            button.style.color = '#ffffff';
                            setTimeout(() => {
                                button.style.backgroundColor = '';
                                button.style.color = '';
                            }, 1000);
                            
                            // ìƒˆë¡œìš´ í–‰ ì¶”ê°€ ë° í¬ì»¤ìŠ¤ ì´ë™
                            const newRow = addNewRow(currentRow);
                            
                            // ìƒˆ í–‰ì˜ ê³¨í”„ì¥ í•„ë“œì— í¬ì»¤ìŠ¤
                            setTimeout(() => {
                                const newGolfCourseInput = newRow.querySelector('[data-field="golfCourse"]');
                                if (newGolfCourseInput) {
                                    newGolfCourseInput.focus();
                                }
                            }, 200);
                        } else {
                            console.log('âŒ saveCurrentRow ì‹¤íŒ¨');
                            // ì‹¤íŒ¨í•œ ê²½ìš° ì‹œê°ì  í”¼ë“œë°±
                            button.style.backgroundColor = '#dc3545';
                            button.style.color = '#ffffff';
                            setTimeout(() => {
                                button.style.backgroundColor = '';
                                button.style.color = '';
                            }, 1000);
                        }
                        
                        // ì €ì¥ í”Œë˜ê·¸ í•´ì œ
                        currentRow.dataset.saving = 'false';
                    }
                });
                
                // í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ ì¶”ê°€
                button.addEventListener('focus', () => {
                    button.style.outline = '2px solid #007bff';
                });
                
                button.addEventListener('blur', () => {
                    button.style.outline = '';
                });
            });
        }

        // í–‰ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
        function collectRowData(row) {
            const data = {};
            const inputs = row.querySelectorAll('.cell-input, .cell-select');
            
            inputs.forEach(input => {
                const field = input.dataset.field;
                data[field] = input.value;
                
                if (field === 'golfCourse' && input.dataset.courseId) {
                    data.courseId = input.dataset.courseId;
                }
            });
            
            return data;
        }

        // ë“œë¡­ë‹¤ìš´ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateDropdownSelection(items) {
            items.forEach((item, index) => {
                if (index === currentDropdownIndex) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleKeyDown(e, input) {
            // ê³¨í”„ì¥ í•„ë“œì—ì„œ ë“œë¡­ë‹¤ìš´ì´ í‘œì‹œëœ ê²½ìš° ë°©í–¥í‚¤ ì²˜ë¦¬
            if (input.dataset.field === 'golfCourse') {
                const dropdown = input.parentElement.querySelector('.golf-course-dropdown');
                if (dropdown && dropdown.style.display === 'block') {
                    const items = dropdown.querySelectorAll('.dropdown-item');
                    
                    switch (e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            currentDropdownIndex = Math.min(currentDropdownIndex + 1, items.length - 1);
                            updateDropdownSelection(items);
                            return;
                            
                        case 'ArrowUp':
                            e.preventDefault();
                            currentDropdownIndex = Math.max(currentDropdownIndex - 1, -1);
                            updateDropdownSelection(items);
                            return;
                            
                        case 'Enter':
                            e.preventDefault();
                            if (currentDropdownIndex >= 0 && items[currentDropdownIndex]) {
                                const selectedItem = items[currentDropdownIndex];
                                const courseData = currentDropdownResults[currentDropdownIndex];
                                selectGolfCourse(input, courseData);
                                dropdown.style.display = 'none';
                                currentDropdownIndex = -1;
                                return;
                            }
                            break;
                            
                        case 'Escape':
                            e.preventDefault();
                            dropdown.style.display = 'none';
                            currentDropdownIndex = -1;
                            return;
                    }
                }
            }
            
            switch (e.key) {
                case 'Tab':
                    e.preventDefault();
                    if (e.shiftKey) {
                        focusPreviousField(input);
                    } else {
                        focusNextField(input);
                    }
                    break;
                    
                case ' ': // Space
                    if (input.tagName === 'SELECT') {
                        e.preventDefault();
                        const currentIndex = input.selectedIndex;
                        const nextIndex = (currentIndex + 1) % input.options.length;
                        input.selectedIndex = nextIndex;
                        
                        // ì„ ì…ê¸ˆì—ì„œ ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¥´ë©´ ì‹ì‚¬ë¡œ ë°”ë¡œ ì´ë™
                        if (input.dataset.field === 'prepay') {
                            focusNextField(input);
                        }
                    }
                    // INPUT í•„ë“œì—ì„œëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ê°€ ì¼ë°˜ ë¬¸ì ì…ë ¥ìœ¼ë¡œë§Œ ì‘ë™
                    break;
                    
                case 'Escape':
                    e.preventDefault();
                    cancelCurrentRow();
                    break;
            }
        }

        // í˜„ì¬ í–‰ ì €ì¥ (ë¡œì»¬ ì €ì¥)
        async function saveCurrentRow() {
            // í˜„ì¬ í™œì„±í™”ëœ í–‰ ì°¾ê¸°
            const editingRow = document.querySelector('#teeTimeBody tr.editing');
            if (!editingRow) {
                console.log('í¸ì§‘ ì¤‘ì¸ í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return false;
            }
            
            const rowData = collectRowData(editingRow);
            
            // ìœ íš¨ì„± ê²€ì¦
            const validation = validateRowData(rowData);
            if (!validation.valid) {
                showMessage('error', validation.message);
                return false;
            }
            
            console.log('ì €ì¥í•  ë°ì´í„°:', rowData);
            
            // ì €ì¥ ìƒíƒœ í‘œì‹œ
            editingRow.classList.add('saving');
            
            try {
                console.log('ğŸ“ localStorage ì €ì¥ ì‹œì‘...');
                
                // ë¡œì»¬ ì €ì¥ (ì„ì‹œ)
                const teeTimeId = 'local_' + Date.now();
                console.log('ğŸ†” ìƒì„±ëœ ID:', teeTimeId);
                
                // ì €ì¥ëœ í‹°íƒ€ì„ ë°ì´í„°
                const savedTeeTime = {
                    id: teeTimeId,
                    ...rowData,
                    savedAt: new Date().toISOString()
                };
                console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„°:', savedTeeTime);
                
                // localStorageì— ì €ì¥
                console.log('ğŸ”„ ê¸°ì¡´ localStorage ë°ì´í„° ì½ê¸°...');
                const savedTimes = JSON.parse(localStorage.getItem('savedTeeTimes') || '[]');
                console.log('ğŸ“‹ ê¸°ì¡´ ë°ì´í„° ê°œìˆ˜:', savedTimes.length);
                
                savedTimes.push(savedTeeTime);
                console.log('â• ìƒˆ ë°ì´í„° ì¶”ê°€ í›„ ê°œìˆ˜:', savedTimes.length);
                
                localStorage.setItem('savedTeeTimes', JSON.stringify(savedTimes));
                console.log('âœ… localStorage ì €ì¥ ì™„ë£Œ');
                
                // ì €ì¥ í™•ì¸
                const verification = JSON.parse(localStorage.getItem('savedTeeTimes') || '[]');
                console.log('ğŸ” ì €ì¥ í™•ì¸ - í˜„ì¬ ê°œìˆ˜:', verification.length);
                
                // í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
                editingRow.classList.remove('editing', 'saving');
                editingRow.classList.add('saved');
                editingRow.dataset.teeTimeId = teeTimeId;
                console.log('ğŸ·ï¸ í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
                // ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                totalTeeTimeCount++;
                updateTotalCount();
                console.log('ğŸ“Š ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', totalTeeTimeCount);
                
                showMessage('success', 'í‹°íƒ€ì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ë§¤íŠ¸ë¦­ìŠ¤ ë·° ì—…ë°ì´íŠ¸ (index.htmlì—ì„œ ì‚¬ìš©)
                try {
                    updateMatrixView(savedTeeTime);
                    console.log('ğŸ”„ ë§¤íŠ¸ë¦­ìŠ¤ ë·° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } catch (matrixError) {
                    console.warn('ë§¤íŠ¸ë¦­ìŠ¤ ë·° ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ (ë¬´ì‹œë¨):', matrixError);
                }
                
                console.log('âœ¨ saveCurrentRow í•¨ìˆ˜ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ');
                return true;
                
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                showMessage('error', 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return false;
            } finally {
                editingRow.classList.remove('saving');
            }
        }
        
        // ë§¤íŠ¸ë¦­ìŠ¤ ë·° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMatrixView(teeTime) {
            // ë©”ì¸ í˜ì´ì§€ì˜ ë§¤íŠ¸ë¦­ìŠ¤ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë°œìƒ
            window.dispatchEvent(new CustomEvent('teeTimeAdded', {
                detail: teeTime
            }));
        }

        // í–‰ ë°ì´í„° ìˆ˜ì§‘
        function collectRowData(row) {
            const golfCourseEl = row.querySelector('[data-field="golfCourse"]');
            const regionEl = row.querySelector('[data-field="region"]');
            const dateEl = row.querySelector('[data-field="date"]');
            const timeEl = row.querySelector('[data-field="time"]');
            const greenFeeEl = row.querySelector('[data-field="greenFee"]');
            const playersEl = row.querySelector('[data-field="players"]');
            const requestEl = row.querySelector('[data-field="request"]');
            const holeEl = row.querySelector('[data-field="hole"]');
            const caddyEl = row.querySelector('[data-field="caddy"]');
            const prepayEl = row.querySelector('[data-field="prepay"]');
            const mealEl = row.querySelector('[data-field="meal"]');
            const cartEl = row.querySelector('[data-field="cart"]');
            const otherEl = row.querySelector('[data-field="other"]');
            
            const players = parseInt(playersEl.value) || 1;
            const bookingType = determineBookingType(players);
            
            // ì‹œê°„ í¬ë§· ë³€í™˜ (1030 â†’ 10:30)
            const timeValue = timeEl ? timeEl.value : '';
            let formattedTime = '09:00'; // ê¸°ë³¸ê°’
            if (timeValue && timeValue.length >= 3) {
                const hours = timeValue.substring(0, timeValue.length - 2).padStart(2, '0');
                const minutes = timeValue.substring(timeValue.length - 2);
                formattedTime = `${hours}:${minutes}`;
            }
            
            return {
                ê³¨í”„ì¥ëª…: golfCourseEl ? golfCourseEl.value : '',
                ê³¨í”„ì¥_id: parseInt(golfCourseEl ? golfCourseEl.dataset.courseId : '0') || 0,
                ì§€ì—­: regionEl ? regionEl.value : '',
                ë‚ ì§œ: dateEl ? dateEl.value : '',
                í‹°íƒ€ì„: formattedTime,
                í‹°ì—…ì‹œê°„_ì›ë³¸: timeValue,
                ê·¸ë¦°í”¼: parseFloat(greenFeeEl ? greenFeeEl.value : '0') || 0,
                ì¸ì›: players,
                ìš”ì²­ì‚¬í•­: requestEl ? requestEl.value : '',
                í™€ì„ íƒ: holeEl ? holeEl.value : '',
                ìºë””: caddyEl ? caddyEl.value : '',
                ì„ ì…ê¸ˆ: prepayEl ? prepayEl.value : '',
                ì‹ì‚¬: mealEl ? mealEl.value : '',
                ì¹´íŠ¸ë¹„í¬í•¨: cartEl ? cartEl.value : '',
                ê¸°íƒ€: otherEl ? otherEl.value : '',
                ìœ í˜•: 'DAILY',
                ì˜ˆì•½ìœ í˜•: bookingType
            };
        }

        // ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
        function validateRowData(data) {
            if (!data.ê³¨í”„ì¥_id || isNaN(data.ê³¨í”„ì¥_id)) {
                return { valid: false, message: 'ê³¨í”„ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.' };
            }
            
            if (!data.ë‚ ì§œ || !data.ë‚ ì§œ.match(/^\d{4}-\d{2}-\d{2}$/)) {
                return { valid: false, message: 'ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (MMDD).' };
            }
            
            if (!data.ê·¸ë¦°í”¼ || isNaN(data.ê·¸ë¦°í”¼) || data.ê·¸ë¦°í”¼ <= 0) {
                return { valid: false, message: 'ì˜¬ë°”ë¥¸ ê·¸ë¦°í”¼ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' };
            }
            
            if (!data.ì¸ì› || isNaN(data.ì¸ì›) || data.ì¸ì› < 1 || data.ì¸ì› > 4) {
                return { valid: false, message: 'ì¸ì›ì€ 1-4ëª… ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.' };
            }
            
            return { valid: true };
        }

        // í˜„ì¬ í–‰ ì·¨ì†Œ
        function cancelCurrentRow() {
            if (currentEditingRow) {
                const rowId = currentEditingRow.dataset.rowId;
                const teeTimeId = currentEditingRow.dataset.teeTimeId;
                
                if (!teeTimeId) {
                    // ì €ì¥ë˜ì§€ ì•Šì€ ìƒˆ í–‰ì´ë©´ ì‚­ì œ
                    currentEditingRow.remove();
                    showMessage('info', 'ì…ë ¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ì €ì¥ëœ í–‰ì´ë©´ í¸ì§‘ ëª¨ë“œë§Œ í•´ì œ
                    currentEditingRow.classList.remove('editing');
                    showMessage('info', 'í¸ì§‘ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                currentEditingRow = null;
            }
        }

        // í–‰ ì¶”ê°€ (ë²„íŠ¼ í´ë¦­)
        function addRowAfter(btn) {
            const currentRow = btn.closest('tr');
            addNewRow(currentRow);
        }

        // í–‰ ì‚­ì œ
        function deleteRow(btn) {
            const row = btn.closest('tr');
            const teeTimeId = row.dataset.teeTimeId;
            
            if (confirm('ì´ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                if (teeTimeId) {
                    // DBì—ì„œ ì‚­ì œ (ì‹¤ì œ êµ¬í˜„ í•„ìš”)
                    totalTeeTimeCount--;
                    updateTotalCount();
                }
                
                row.remove();
                showMessage('success', 'í–‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateTotalCount() {
            document.getElementById('totalCount').textContent = totalTeeTimeCount;
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', async function() {
            await loadGolfCourses();
            
            // ì²« ë²ˆì§¸ í–‰ ì¶”ê°€
            addNewRow();
            
            // í˜ì´ì§€ ë¡œë“œ í›„ ê³¨í”„ì¥ í•„ë“œì— ìë™ í¬ì»¤ìŠ¤
            setTimeout(() => {
                const firstGolfCourseInput = document.querySelector('#teeTimeBody tr [data-field="golfCourse"]');
                if (firstGolfCourseInput) {
                    firstGolfCourseInput.focus();
                    console.log('ğŸ¯ ê³¨í”„ì¥ ì…ë ¥ í•„ë“œì— ìë™ í¬ì»¤ìŠ¤ ì„¤ì •');
                }
            }, 500); // í–‰ ìƒì„± í›„ ì¶©ë¶„í•œ ì‹œê°„ ëŒ€ê¸°
            
            showMessage('info', 'í‚¤ë³´ë“œë¡œ ë¹ ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”! Tabìœ¼ë¡œ ì´ë™, Enterë¡œ ì €ì¥');
        });

        // ì „ì—­ í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            // Ctrl+Enter: ê°•ì œ ì €ì¥
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                if (currentEditingRow) {
                    saveCurrentRow();
                }
            }
        });
    </script>
    </div> <!-- container end -->
</body>
</html>